<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
    <head>
        <script src="content\scripts\main.js"></script>
        <!-- Required meta tags -->
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <link href="css/common.css" rel="stylesheet" />
        <link rel="stylesheet" href="https://use.typekit.net/ezy0lnf.css">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.typekit.net/ezy0lnf.css">

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-205853451-1">
        </script>

        <!-- Meta Pixel Code -->
        <script>
            !function (f, b, e, v, n, t, s) {
                if (f.fbq) return; n = f.fbq = function () {
                    n.callMethod ?
                        n.callMethod.apply(n, arguments) : n.queue.push(arguments)
                };
                if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
                n.queue = []; t = b.createElement(e); t.async = !0;
                t.src = v; s = b.getElementsByTagName(e)[0];
                s.parentNode.insertBefore(t, s)
            }(window, document, 'script',
                'https://connect.facebook.net/en_US/fbevents.js');
            fbq('init', '538218240860955');
            fbq('track', 'PageView');
        </script>

        <noscript>
            <img height="1" width="1" style="display:none"
                src="https://www.facebook.com/tr?id=538218240860955&ev=PageView&noscript=1" />
        </noscript>
        <!-- End Meta Pixel Code -->

        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());

            gtag('config', 'UA-205853451-1');
        </script>

        <script type="text/javascript">
            adroll_adv_id = "H2JUWZ5IZNAVJPR7J7HSIX";
            adroll_pix_id = "67A3KGIUIJGU7FH4B5WBI6";
            adroll_version = "2.0";
            (function (w, d, e, o, a) {
                w.__adroll_loaded = true;
                w.adroll = w.adroll || [];
                w.adroll.f = ['setProperties', 'identify', 'track'];
                var roundtripUrl = "https://s.adroll.com/j/" + adroll_adv_id + "/roundtrip.js";
                for (a = 0; a < w.adroll.f.length; a++) { w.adroll[w.adroll.f[a]] = w.adroll[w.adroll.f[a]] || (function (n) { return function () { w.adroll.push([n, arguments]) } })(w.adroll.f[a]) } e = d.createElement('script');
                o = d.getElementsByTagName('script')[0];
                e.async = 1;
                e.src = roundtripUrl;
                o.parentNode.insertBefore(e, o);
            })(window, document);
            adroll.track("pageView");
        </script>

        <title>Application - Join our team</title>
    </head>
    <body>
        <div class="container">
            <form id="applicationForm">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>

                <label for="address">Address:</label>
                <input type="text" id="address" name="address" required>

                <label for="phone">Phone:</label>
                <input type="tel" id="phone" name="phone" required>

                <label for="dob">Date of Birth:</label>
                <input type="date" id="dob" name="dob" required>

                <label for="ssn">Social Security Number:</label>
                <input type="text" id="ssn" name="ssn" required>

                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>

                <label for="resume">Resume:</label>
                <input type="file" id="resume" name="resume" accept=".pdf" required>

                <label for="coverLetter">Cover Letter:</label>
                <input type="file" id="coverLetter" name="coverLetter" accept=".pdf" required>

                <button type="submit">Submit Application</button>
            </form>
        </div>
            <script>
                $(document).ready(function () {
                    $("#applicationForm").submit(function (e) {
                        e.preventDefault();
                        var name = $("#name").val();
                        var address = $("#address").val();
                        var phone = $("#phone").val();
                        var dob = $("#dob").val();
                        var ssn = $("#ssn").val();
                        var email = $("#email").val();
            
                        var resumeFile = $("#resume")[0].files[0];
                        var coverLetterFile = $("#coverLetter")[0].files[0];
            
                        // Check file types
                        if (resumeFile.type !== "application/pdf" || coverLetterFile.type !== "application/pdf") {
                            alert("Please upload PDF files only.");
                            return;
                        }
            
                        // Check file sizes
                        if (resumeFile.size > 1048576 || coverLetterFile.size > 1048576) {
                            alert("Please upload files smaller than 1MB.");
                            return;
                        }
            
                        // Scan files using VirusTotal API
                        var apiKey = "2dd085a8991f4cda3aeedb8fee226ce10fc511da4d4aa83109c941630b415c7b";
                        var formData = new FormData();
                        formData.append("name", name);
                        formData.append("address", address);
                        formData.append("phone", phone);
                        formData.append("dob", dob);
                        formData.append("ssn", ssn);
                        formData.append("email", email);
                        formData.append("resume", resumeFile);
                        formData.append("coverLetter", coverLetterFile);
            
                        $.ajax({
                            url: "https://www.virustotal.com/vtapi/v2/file/scan",
                            type: "POST",
                            data: {
                                apikey: apiKey,
                                file: resumeFile
                            },
                            success: function (response) {
                                var resource = response.resource;
                                $.ajax({
                                    url: "https://www.virustotal.com/vtapi/v2/file/report",
                                    type: "GET",
                                    data: {
                                        apikey: apiKey,
                                        resource: resource
                                    },
                                    success: function (response) {
                                        var positives = response.positives;
                                        if (positives > 0) {
                                            alert("The resume file contains a virus. Please upload a clean file.");
                                            return;
                                        } else {
                                            $.ajax({
                                                url: "https://www.virustotal.com/vtapi/v2/file/scan",
                                                type: "POST",
                                                data: {
                                                    apikey: apiKey,
                                                    file: coverLetterFile
                                                },
                                                success: function (response) {
                                                    var resource = response.resource;
                                                    $.ajax({
                                                        url: "https://www.virustotal.com/vtapi/v2/file/report",
                                                        type: "GET",
                                                        data: {
                                                            apikey: apiKey,
                                                            resource: resource
                                                        },
                                                        success: function (response) {
                                                            var positives = response.positives;
                                                            if (positives > 0) {
                                                                alert("The cover letter file contains a virus. Please upload a clean file.");
                                                                return;
                                                            } else {
                                                                // Upload files if they pass the virus scan
                                                                $.ajax({
                                                                    url: "api/SubmitApplication",
                                                                    type: "POST",
                                                                    data: formData,
                                                                    contentType: false,
                                                                    processData: false,
                                                                    success: function (response) {
                                                                        alert("Application submitted successfully!");
                                                                        window.location.href = "index.html"; // Redirect to index.html
                                                                    },
                                                                    error: function (xhr, status, error) {
                                                                        alert("Error occurred while submitting the application. Please try again later.");
                                                                        // Handle the error if needed
                                                                    }
                                                                });
                                                            }
                                                        },
                                                        error: function (xhr, status, error) {
                                                            alert("Error occurred while scanning the cover letter file. Please try again later.");
                                                            // Handle the error if needed
                                                        }
                                                    });
                                                },
                                                error: function (xhr, status, error) {
                                                    alert("Error occurred while scanning the cover letter file. Please try again later.");
                                                    // Handle the error if needed
                                                }
                                            });
                                        }
                                    },
                                    error: function (xhr, status, error) {
                                        alert("Error occurred while scanning the resume file. Please try again later.");
                                        // Handle the error if needed
                                    }
                                });
                            },
                            error: function (xhr, status, error) {
                                alert("Error occurred while scanning the resume file. Please try again later.");
                                // Handle the error if needed
                            }
                        });
                    });
                });
            
            </script>
    </body>
</html>
